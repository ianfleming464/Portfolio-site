<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Case Study · Discount Coordination Engine – Ian Fleming</title>

  <link rel="short icon" href="img/favicon-32x32.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>

  <!-- Simple top bar back link -->
  <header class="header" style="border-bottom:1px solid rgba(0,0,0,.06)">
    <div class="logo"><img src="img/Ian Fleming logo.png" alt=""/></div>
    <nav class="nav-inline">
      <a class="nav-inline__link" href="index.html#work"><i class="fas fa-arrow-left"></i> Back to My Work</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="case-hero">
    <div class="container">
      <h1 class="case-title">Cart Discount Coordination Engine</h1>
      <p class="case-subtitle">Unifying independent discount systems into a single, trustworthy cart interface.</p>

      <div class="case-meta">
        <span class="pill">Role: Lead Developer</span>
        <span class="pill">Deployed to 8 storefronts</span>
        <span class="pill">Stack: JS · DOM APIs · Event-Driven Architecture</span>
      </div>
    </div>
  </section>

  <!-- OVERVIEW GRID -->
  <section class="case-grid container">
    <div class="case-main">
      <h2>The Problem</h2>
      <p>
        Three independent systems (platform, third-party cart, user input) apply discounts in isolation. When systems don't communicate cleanly, users see inconsistent prices and lose trust. Example: cart displays €100, checkout shows €85—no explanation of where the €15 went.
      </p>

      <p>
        The result? High support volume from pricing confusion, abandoned carts, and eroded customer confidence.
      </p>

      <h2>The Solution</h2>
      <p>
        Built a unified coordination layer that detects all discount sources simultaneously, calculates their combined impact with mathematical precision, and displays truthful prices in real-time across line items. Cart totals now match checkout—eliminating the largest category of support tickets.
      </p>

      <h3>Key Technical Decisions</h3>
      
      <p><strong>State Signature Tracking</strong><br>
      Instead of reprocessing on every cart change, I track a "signature" of the current discount + items. If nothing has changed, skip recalculation. This prevents unnecessary DOM thrashing on high-traffic carts.
      </p>

      <p><strong>Proportional Allocation with Rounding Reconciliation</strong><br>
      When applying a discount across multiple items, naive rounding causes €0.01 discrepancies. Implemented a two-pass algorithm: first allocate proportionally, then reconcile remainders to ensure the total always matches expectations exactly.
      </p>

      <p><strong>Platform-Aware Mode Detection</strong><br>
      Discovered that automatic discounts and URL-based discounts are managed differently by the platform. Rather than fight this, I built the system to detect which mode is active and defer to the platform when appropriate—only applying custom logic for manual codes. This means working <em>with</em> platform constraints rather than against them.
      </p>

      <p><strong>Multi-Mode Combination Handling</strong><br>
      Recently added dynamic multiples support (3-for-2, 4-for-3 patterns). The tricky part: when customers combine a multiples code with a percentage discount, we need to calculate which items are free vs. discounted, then allocate the percentage across only the paid items. System now detects this scenario and handles it correctly.
      </p>

      <h3>Architecture (High Level)</h3>
      <ul class="bullets-tight">
        <li><strong>Discount Detection:</strong> Polls for active codes and automatic discounts</li>
        <li><strong>Allocation Engine:</strong> Calculates proportional distributions with precision</li>
        <li><strong>DOM Renderer:</strong> Updates line-item prices with proper formatting</li>
        <li><strong>State Manager:</strong> Tracks original prices and current state</li>
        <li><strong>Combination Handler:</strong> Manages multi-discount scenarios (multiples + percentage, etc.)</li>
      </ul>

      <p>Each handler works independently but coordinates through a central coordinator that decides execution order and passes data forward.</p>

      <h3>Technical Challenges</h3>
      
      <p><strong>Mathematical Precision:</strong> Ensuring proportional discount allocation across mixed cart items (percentage vs. fixed amounts) while maintaining subtotal accuracy. When distributing a 15% discount across items with different prices, simple proportional math creates rounding errors. Solved with a two-pass algorithm that reconciles remainders.
      </p>

      <p><strong>Complex Combinations:</strong> When multiples (3-for-2, 4-for-3) combine with percentage discounts, the system must identify which items are free, allocate the percentage discount only to paid items, and display both discount types clearly. This is difficult to represent natively in the cart. Shopify applies automatic discounts only at checkout level—the cart has no native way to preview them. Meanwhile, manual discount codes are handled at the cart level. Rebuy (the third-party cart system) is UI-only and can't enforce discount logic itself. This creates a gap: customers see one price in the cart, a different price at checkout, with no explanation. The system must detect which discount type is active, where it's being applied (cart vs. checkout), and coordinate the display across incompatible systems so the cart preview matches checkout reality.
      </p>

      <p><strong>Debugging at Scale:</strong> The system handles 7+ discount types in combination across 8 storefronts with different configurations. Built extensive debug logging that can be enabled via browser console, providing real-time visibility into state changes and calculations.
      </p>

      <h3>Impact</h3>
      <ul>
        <li><strong>Consistency:</strong> Cart totals now match checkout—eliminated the largest source of support tickets</li>
        <li><strong>International Scale:</strong> Deployed across 8 storefronts with multi-currency, multi-language support</li>
        <li><strong>Complex Scenarios:</strong> System handles 7+ discount types in combination without breaking</li>
        <li><strong>Performance:</strong> Optimized for high-frequency cart updates with intelligent change detection</li>
        <li><strong>Trust:</strong> Customers see accurate, truthful pricing at every step</li>
      </ul>

      <h3>What I Learned</h3>
      <p>Sometimes the best engineering isn't about forcing incompatible systems to talk—it's about building a coordination layer that works <em>with</em> platform constraints rather than against them. Discovering that certain discount types are managed at checkout level meant I could stop trying to fully replicate that logic and instead focus on providing accurate preview prices for scenarios the platform doesn't handle natively.</p>

      <h3>Future Improvements</h3>
      <ul>
        <li>Abstract platform-specific integrations for broader applicability</li>
        <li>Develop standardized interfaces for different cart systems</li>
        <li>Create adapter patterns for use across multiple platforms</li>
      </ul>

      <div class="project-links" style="margin-top:1.25rem">
        <a href="https://github.com/ianfleming464/cart-discount-coordination-engine-documentation" class="btn">Technical Docs</a>
        <a href="files/Ian_Fleming_Resume.pdf" class="btn btn--ghost" target="_blank">Download Resume</a>
        <a href="index.html#work" class="btn btn--ghost">Back to Work</a>
      </div>
    </div>

    <!-- SIDE META -->
    <aside class="case-side">
      <div class="side-card">
        <h4>Role & Scope</h4>
        <ul class="bullets-tight">
          <li>Lead developer</li>
          <li>Frontend JS + cart UX</li>
          <li>Multi-platform deployment</li>
          <li>Architecture design</li>
        </ul>
      </div>

      <div class="side-card">
        <h4>Stack</h4>
        <ul class="bullets-tight">
          <li>JavaScript (ES6+)</li>
          <li>DOM APIs</li>
          <li>Event-driven architecture</li>
          <li>Mathematical algorithms</li>
        </ul>
      </div>

      <div class="side-card">
        <h4>Key Patterns</h4>
        <ul class="bullets-tight">
          <li>Proportional allocation algorithms</li>
          <li>State signature tracking</li>
          <li>Platform-aware mode detection</li>
          <li>Event coordination</li>
          <li>Multi-currency formatting</li>
        </ul>
      </div>
    </aside>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <a href="mailto:ianflemingdeveloper@gmail.com" class="footer__link">ianflemingdeveloper@gmail.com</a>
    <ul class="social-list">
      <li class="social-list__item"><a class="social-list__link" href="https://github.com/ianfleming464/" target="_blank"><i class="fab fa-github"></i></a></li>
      <li class="social-list__item"><a class="social-list__link" href="https://www.linkedin.com/in/i-fleming/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
    </ul>
  </footer>

</body>
</html>